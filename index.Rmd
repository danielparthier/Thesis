--- 
title: "Medial Septal Projections to the Parasubiculum"
author: "Daniel Parthier"
date: "`r format(x = as.Date(Sys.Date()), '%d.%m.%Y')`"
documentclass: book
classoption: openany
fontsize: 12pt
geometry: left=3cm, right=3cm, top=2.5cm, bottom=2.5cm
linestretch: 1.5
link-citations: yes
mainfont: URW Nimbus Roman
bibliography:
- book.bib
- packages.bib
- references.bib
- Thesis.bib
sansfont: URW Nimbus Roman
site: bookdown::bookdown_site
subtitle: |
  | Inaugural-Dissertation
  | to obtain the academic degree
  | Doctor rerum naturalium (Dr. rer. nat.)
  |
  | submitted to the Department of Biology, Chemistry and Pharmacy
  | of Freie Universität Berlin by
biblio-style: apalike
latex_engine: xelatex
toc-depth: 1
output: 
  pdf_document2:
    keep_tex: yes
---

# Prerequisites

The experimental work of this thesis was completed from xx.xx.xx to xx.xx.xx under the supervision of Prof. Dr. Dietmar Schmitz at the Neuroscience Research Centre (NWFZ) of the Charité.

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown', 'data.table'
), 'packages.bib')
knitr::opts_chunk$set(dev = 'pdf')
#knitr::opts_chunk$set(dev = 'png')
library('magrittr')
library('png')
library('ggh4x')
library('ggplot2')
library('data.table')
library('patchwork')
library('knitr')
library('kableExtra')

InputParameters <- readRDS(file = "/alzheimer/Daniel_Data/R/Thesis/Data/InputParameters.rds")
ParameterCompTable <- readRDS(file = "/alzheimer/Daniel_Data/R/In-Vitro-ConnectivityAnalysis/Output/ParameterComparisons.rds")
CellChar <- readRDS(file = "/alzheimer/Daniel_Data/R/In-Vitro-ConnectivityAnalysis/Output/CellChar.rds")
source("/alzheimer/Daniel_Data/R/In-Vitro-ConnectivityAnalysis/R/ParPostProcessing.R")
source("/alzheimer/Daniel_Data/R/In-Vitro-ConnectivityAnalysis/R/PlotFunctions.R")

ParameterCompTable[,`non-zero`:="",][OutOfInterval==1,`non-zero`:="yes",]
setnames(x = ParameterCompTable, old = c("GroupComparison"), new=c("Comparison"))
setorder(ParameterCompTable, "Parameter")

#### input onset PV
testDataOnset <- InputParameters[!is.na(PulseTime)&Drug==F&Mouseline=="PV",,]
testDataOnset[,RowID:=.I,]
testDataOnset[,CellTypeMouse := paste0(Mouseline,CellType),]
testDataOnset <- testDataOnset[Onset>0&!grepl(pattern = "blocked by NBQX", x = Comment)&PulseNr==1,]
testDataOnset <- testDataOnset[Cell!="160810_5_RSadjn"&abs(PeakAmp)>3*BaselineSD,][(Clamp=="CC"&abs(PeakAmp)>0.2)|(Clamp=="VC"&abs(PeakAmp)>5),]
InputOnsets <- testDataOnset[,.N,by=.(CellType)]
InputOnsetsCells <- testDataOnset[,.(.N, unique(Cell)),by=.(CellType)][,.N,by=CellType]

#### log ods comparison connectivity
LogOddsCompConnectivity <- readRDS(file = "/alzheimer/Daniel_Data/R/Thesis/HDILogOddsComparison.rds")
LogOddsCompConnectivity[,Comparison:=GroupComparison,]
LogOddsCompConnectivity[!grepl(pattern = "ChAT", x = GroupComparison), MouseLine:="PV",][!grepl(pattern = "PV", x = GroupComparison), MouseLine:="ChAT",][is.na(MouseLine),MouseLine:="Cross",]


HDIEx <- function(x, digits=2) {
    x[,paste0("$[",trimws(format(round(`2.5%`, digits = digits), nsmall = digits)),"; ", trimws(format(round(`97.5%`, digits = digits), nsmall = digits)),"]$"),]
}
HDItxt <- function(x, digits=2, unit="") {
  x[,paste0("$", trimws(format(round(`50%`, digits = digits), nsmall = digits)),unit,"$ $[",trimws(format(round(`2.5%`, digits = digits), nsmall = digits)),"; ", trimws(format(round(`97.5%`, digits = digits), nsmall = digits)),"]$"),]
}
HDICt <- function(x, digits=2, unit="", sig="only") {
  if(any(grepl(pattern = "Cell Type",names(x)))) {
  x[,paste0(`Cell Type`,": $" , trimws(format(round(`50%`, digits = digits), nsmall = digits)),unit,"$ $[",trimws(format(round(`2.5%`, digits = digits), nsmall = digits)),"; ", trimws(format(round(`97.5%`, digits = digits), nsmall = digits)),"]$", collapse = ", "),]
  } else   if(any(grepl(pattern = "Comparison",names(x)))) {
  switch (sig,
    "only" = {Select <- 1},
    "no" = {Select <- 0},
    "all" = {Select <-c(0,1)},
  )
  ComparisonString <- grep(pattern = "Comparison",names(x), value = T)
  x[OutOfInterval%in%Select,paste0(get(ComparisonString),": $" , trimws(format(round(`50%`, digits = digits), nsmall = digits)),unit,"$ $[",trimws(format(round(`2.5%`, digits = digits), nsmall = digits)),"; ", trimws(format(round(`97.5%`, digits = digits), nsmall = digits)),"]$", collapse = ", "),]
}
}
HDISummary <- function(x, digits=2, unit="", sig="all") {
  if(any(grepl(pattern = "Cell Type",names(x)))) {
  x[,paste0(GroupComparison,": $" , trimws(format(round(`50%`, digits = digits), nsmall = digits)),unit,"$ $[",trimws(format(round(`2.5%`, digits = digits), nsmall = digits)),"; ", trimws(format(round(`97.5%`, digits = digits), nsmall = digits)),"]$", collapse = ", "),]
  } else   if(any(grepl(pattern = "Comparison",names(x)))) {
  switch (sig,
    "only" = {Select <- 1},
    "no" = {Select <- 0},
    "all" = {Select <-c(0,1)},
  )
  x[OutOfInterval%in%Select,paste0(GroupComparison,": $" , trimws(format(round(`50%`, digits = digits), nsmall = digits)),unit,"$ $[",trimws(format(round(`2.5%`, digits = digits), nsmall = digits)),"; ", trimws(format(round(`97.5%`, digits = digits), nsmall = digits)),"]$", collapse = ", "),]
}
}



```
